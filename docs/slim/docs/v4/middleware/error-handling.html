<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Error Middleware - Slim Framework</title>
        <meta name="description" content="">
        <meta name="robots" content="index, follow">
        <meta property="og:title" content="Error Middleware">
        <meta property="og:site_name" content="Slim Framework">
        <meta property="og:url" content="https://www.slimframework.com/docs/v4/middleware/error-handling.html">
        <meta property="og:description" content="">
        <meta property="og:type" content="website">
        <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
        <link rel="stylesheet" href="../../../assets/css/all.css">
        <link rel="stylesheet" href="../../../npm/docsearch.js%402/dist/cdn/docsearch.min.css">
        <link rel="shortcut icon" href="../../../assets/images/favicon.png">
        <link rel="stylesheet" href="../../../font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="../../../css?family=Lato:400,700" rel="stylesheet">
        <script src="../../../yjz4fyo.js"></script>
        <script>try{Typekit.load();}catch(e){}</script>
        <script>
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-19430723-1']);
            _gaq.push(['_trackPageview']);
            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </head>
    <body>
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-logo" href="/">Slim</a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a href="/blog">Blog</a></li>
                        <li class="active"><a href="/docs/v4">User Guide</a></li>
                        <li><a href="https://discourse.slimframework.com/">Support</a></li>
                        <li><a href="/contribute">Contribute</a></li>
                    </ul>
                    
                        
                        
                            
                        
                            
                        
                            
                                <div class="navbar-documentation-version-badge">
                                    <span>v4 Documentation</span>
                                </div>
                        
                        
                    
                </div>
            </div>
        </nav>

<div class="wrapper docs">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="toc-nav-toggle">
                    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#tocNav" aria-expanded="false" aria-controls="tocNav">
                        Toggle Navigation
                    </button>
                </div>
                <div class="collapse toc-nav-collapse" id="tocNav">
                    <h3 class="toc-title" style="margin-top:0">Slim Version</h3>
<div style="border:1px solid #CCC;border-radius:16px;box-sizing:border-box;margin:0 0 30px;padding:0 8px;width:200px;-webkit-appearance:none">
    <select onchange="this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value);" style="border:0;border-radius:16px;height:32px;margin:0;outline:none;padding:0;width:100%">
        
        
            
            
            <option value="/docs/v2">v2</option>
        
            
            
            <option value="/docs/v3">v3</option>
        
            
            
            <option value="/docs/v4" selected="">v4</option>
        
    </select>
</div>

                    <h3 class="toc-title">Search</h3>
<div class="svg-icons" style="height: 0; width: 0; position: absolute; visibility: hidden">
    <svg xmlns="http://www.w3.org/2000/svg">
        <symbol id="sbx-icon-clear-3" viewbox="0 0 40 40"><path d="M16.228 20L1.886 5.657 0 3.772 3.772 0l1.885 1.886L20 16.228 34.343 1.886 36.228 0 40 3.772l-1.886 1.885L23.772 20l14.342 14.343L40 36.228 36.228 40l-1.885-1.886L20 23.772 5.657 38.114 3.772 40 0 36.228l1.886-1.885L16.228 20z" fill-rule="evenodd"></path></symbol>
        <symbol id="sbx-icon-search-13" viewbox="0 0 40 40"><path d="M26.806 29.012a16.312 16.312 0 0 1-10.427 3.746C7.332 32.758 0 25.425 0 16.378 0 7.334 7.333 0 16.38 0c9.045 0 16.378 7.333 16.378 16.38 0 3.96-1.406 7.593-3.746 10.426L39.547 37.34c.607.608.61 1.59-.004 2.203a1.56 1.56 0 0 1-2.202.004L26.807 29.012zm-10.427.627c7.322 0 13.26-5.938 13.26-13.26 0-7.324-5.938-13.26-13.26-13.26-7.324 0-13.26 5.936-13.26 13.26 0 7.322 5.936 13.26 13.26 13.26z" fill-rule="evenodd"></path></symbol>
    </svg>
</div>
<form novalidate="novalidate" onsubmit="return false;" class="searchbox" style="visibility:hidden;height:0;margin-bottom:30px">
    <div role="search" class="searchbox__wrapper">
        <input id="docsearch" type="search" name="search" placeholder="Search in the doc" autocomplete="off" required="required" class="searchbox__input">
        <button type="submit" title="Submit your search query." class="searchbox__submit">
            <svg role="img" aria-label="Search">
                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#sbx-icon-search-13"></use>
            </svg>
        </button>
        <button type="reset" title="Clear the search query." class="searchbox__reset hide">
            <svg role="img" aria-label="Reset">
                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#sbx-icon-clear-3"></use>
            </svg>
        </button>
    </div>
</form>
                    
                        
                        
                        <h3 class="toc-title">Get Started</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="../index.htm">Home</a></li>
                            
                                
                                <li><a href="../start/installation.html">Installation</a></li>
                            
                                
                                <li><a href="../start/web-servers.html">Web Servers</a></li>
                            
                                
                                <li><a href="../deployment/deployment.html">Deployment</a></li>
                            
                                
                                <li><a href="../start/upgrade.html">Upgrade Guide</a></li>
                            
                        </ul>
                    
                        
                        
                        <h3 class="toc-title">Concepts</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="../concepts/life-cycle.html">Application Life Cycle</a></li>
                            
                                
                                <li><a href="../concepts/value-objects.html">PSR-7</a></li>
                            
                                
                                <li><a href="../concepts/middleware.html">Middleware</a></li>
                            
                                
                                <li><a href="../concepts/di.html">Dependency Container</a></li>
                            
                        </ul>
                    
                        
                        
                        <h3 class="toc-title">The Application</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="../objects/application.html">Overview</a></li>
                            
                                
                                <li><a href="../objects/application.html#advanced-notices-and-warnings-handling">Notices & Warnings Handling</a></li>
                            
                        </ul>
                    
                        
                        
                        <h3 class="toc-title">The Request</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="../objects/request.html">Overview</a></li>
                            
                                
                                <li><a href="../objects/request.html#the-request-method">Method</a></li>
                            
                                
                                <li><a href="../objects/request.html#the-request-headers">Headers</a></li>
                            
                                
                                <li><a href="../objects/request.html#the-request-body">Body</a></li>
                            
                                
                                <li><a href="../objects/request.html#uploaded-files">Uploaded Files</a></li>
                            
                                
                                <li><a href="../objects/request.html#request-helpers">Helpers</a></li>
                            
                                
                                <li><a href="../objects/request.html#route-object">Route object</a></li>
                            
                        </ul>
                    
                        
                        
                        <h3 class="toc-title">The Response</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="../objects/response.html">Overview</a></li>
                            
                                
                                <li><a href="../objects/response.html#the-response-status">Status</a></li>
                            
                                
                                <li><a href="../objects/response.html#the-response-headers">Headers</a></li>
                            
                                
                                <li><a href="../objects/response.html#the-response-body">Body</a></li>
                            
                                
                                <li><a href="../objects/response.html#returning-json">JSON</a></li>
                            
                        </ul>
                    
                        
                        
                        <h3 class="toc-title">Routing</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="../objects/routing.html">Overview</a></li>
                            
                                
                                <li><a href="../objects/routing.html#how-to-create-routes">Create Routes</a></li>
                            
                                
                                <li><a href="../objects/routing.html#route-callbacks">Callbacks</a></li>
                            
                                
                                <li><a href="../objects/routing.html#route-strategies">Strategies</a></li>
                            
                                
                                <li><a href="../objects/routing.html#route-placeholders">Placeholders</a></li>
                            
                                
                                <li><a href="../objects/routing.html#route-names">Names</a></li>
                            
                                
                                <li><a href="../objects/routing.html#route-groups">Groups</a></li>
                            
                                
                                <li><a href="../objects/routing.html#route-middleware">Middleware</a></li>
                            
                                
                                <li><a href="../objects/routing.html#route-expressions-caching">Caching</a></li>
                            
                                
                                <li><a href="../objects/routing.html#container-resolution">Container Resolution</a></li>
                            
                        </ul>
                    
                        
                        
                        <h3 class="toc-title active">Packaged Middleware</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="routing.html">Routing</a></li>
                            
                                
                                <li><a href="error-handling.html">Error Handling</a></li>
                            
                                
                                <li><a href="method-overriding.html">Method Overriding</a></li>
                            
                                
                                <li><a href="output-buffering.html">Output Buffering</a></li>
                            
                                
                                <li><a href="body-parsing.html">Body Parsing</a></li>
                            
                                
                                <li><a href="content-length.html">Content Length</a></li>
                            
                        </ul>
                    
                        
                        
                        <h3 class="toc-title">Cook book</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="../cookbook/route-patterns.html">Trailing / in routes</a></li>
                            
                                
                                <li><a href="../cookbook/retrieving-current-route.html">Retrieving Current Route</a></li>
                            
                                
                                <li><a href="../cookbook/database-doctrine.html">Using Doctrine with Slim</a></li>
                            
                                
                                <li><a href="../cookbook/enable-cors.html">Enabling CORS</a></li>
                            
                                
                                <li><a href="../cookbook/uploading-files.html">Uploading Files using POST forms</a></li>
                            
                        </ul>
                    
                        
                        
                        <h3 class="toc-title">Add Ons</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="../features/templates.html">Templates</a></li>
                            
                                
                                <li><a href="../features/twig-view.html">Twig Templates</a></li>
                            
                                
                                <li><a href="../features/php-view.html">PHP Templates</a></li>
                            
                        </ul>
                    
                        
                        
                        <h3 class="toc-title">Contributing</h3>
                        <ul class="toc-links">
                            
                                
                                <li><a href="../contributors/strategy.html">Branching Strategy</a></li>
                            
                                
                                <li><a href="../contributors/guidelines.html">Guidelines</a></li>
                            
                        </ul>
                    

                    <h3 class="toc-title">Professional Support</h3>
                    <ul class="toc-links">
                        <li><a href="https://tidelift.com/subscription/pkg/packagist-slim-slim?utm_source=packagist-slim-slim&utm_medium=referral&utm_campaign=website">Professional support from Tidelift</a></li>
                    </ul>
                </div>
            </div>

            <div class="col-md-8 docs-content">
                <h1 class="page-header">Error Middleware</h1>
                <div class="edit-panel" style="margin: 0 0 1em 0;">
                    <a href="https://github.com/slimphp/Slim-Website/tree/gh-pages/docs/v4/middleware/error-handling.md" target="_blank" class="btn btn-default btn-sm"><i class="fa fa-github"></i> Edit This Page</a>
                </div>
                <p>Things go wrong. 
You can’t predict errors, but you can anticipate them. 
Each Slim Framework application has an error handler that receives all uncaught PHP exceptions. 
This error handler also receives the current HTTP request and response objects, too. 
The error handler must prepare and return an appropriate Response object to be returned to the HTTP client.</p>

<h2 id="usage">Usage</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="cd">/**
 * The routing middleware should be added earlier than the ErrorMiddleware
 * Otherwise exceptions thrown from it will not be handled by the middleware
 */</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addRoutingMiddleware</span><span class="p">();</span>

<span class="cd">/**
 * Add Error Middleware
 *
 * @param bool                  $displayErrorDetails -&gt; Should be set to false in production
 * @param bool                  $logErrors -&gt; Parameter is passed to the default ErrorHandler
 * @param bool                  $logErrorDetails -&gt; Display error details in error log
 * @param LoggerInterface|null  $logger -&gt; Optional PSR-3 Logger  
 *
 * Note: This middleware should be added last. It will not handle any exceptions/errors
 * for middleware added after it.
 */</span>
<span class="nv">$errorMiddleware</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addErrorMiddleware</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// ...</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="adding-custom-error-handlers">Adding Custom Error Handlers</h2>

<p>You can now map custom handlers for any type of Exception or Throwable.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Monolog\Handler\RotatingFileHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Monolog\Logger</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ServerRequestInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Log\LoggerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="c1">// Add Routing Middleware</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addRoutingMiddleware</span><span class="p">();</span>

<span class="c1">// Optional: Define custom error logger</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Logger</span><span class="p">(</span><span class="s1">'error'</span><span class="p">);</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="nf">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nc">RotatingFileHandler</span><span class="p">(</span><span class="s1">'error.log'</span><span class="p">));</span>

<span class="c1">// Define Custom Error Handler</span>
<span class="nv">$customErrorHandler</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span>
    <span class="kt">ServerRequestInterface</span> <span class="nv">$request</span><span class="p">,</span>
    <span class="kt">Throwable</span> <span class="nv">$exception</span><span class="p">,</span>
    <span class="kt">bool</span> <span class="nv">$displayErrorDetails</span><span class="p">,</span>
    <span class="kt">bool</span> <span class="nv">$logErrors</span><span class="p">,</span>
    <span class="kt">bool</span> <span class="nv">$logErrorDetails</span>
<span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">,</span> <span class="nv">$logger</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$logger</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$logger</span><span class="o">-&gt;</span><span class="nf">error</span><span class="p">(</span><span class="nv">$exception</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nv">$payload</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="nv">$exception</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">()];</span>

    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">getResponseFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">createResponse</span><span class="p">();</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span>
        <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$payload</span><span class="p">,</span> <span class="no">JSON_UNESCAPED_UNICODE</span><span class="p">)</span>
    <span class="p">);</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Add Error Middleware</span>
<span class="nv">$errorMiddleware</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addErrorMiddleware</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">$logger</span><span class="p">);</span>
<span class="nv">$errorMiddleware</span><span class="o">-&gt;</span><span class="nf">setDefaultErrorHandler</span><span class="p">(</span><span class="nv">$customErrorHandler</span><span class="p">);</span>

<span class="c1">// ...</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="error-logging">Error Logging</h2>
<p>If you would like to pipe in custom error logging to the default <code class="language-plaintext highlighter-rouge">ErrorHandler</code> that ships with Slim, there are two ways to do it.</p>

<p>With the first method, you can simply extend <code class="language-plaintext highlighter-rouge">ErrorHandler</code> and stub the <code class="language-plaintext highlighter-rouge">logError()</code> method.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">MyApp\Handlers</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Slim\Handlers\ErrorHandler</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MyErrorHandler</span> <span class="kd">extends</span> <span class="nc">ErrorHandler</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="n">logError</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$error</span><span class="p">):</span> <span class="kt">void</span>
    <span class="p">{</span>
        <span class="c1">// Insert custom error logging function.</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">MyApp\Handlers\MyErrorHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="c1">// Add Routing Middleware</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addRoutingMiddleware</span><span class="p">();</span>

<span class="c1">// Instantiate Your Custom Error Handler</span>
<span class="nv">$myErrorHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyErrorHandler</span><span class="p">(</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">getCallableResolver</span><span class="p">(),</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">getResponseFactory</span><span class="p">());</span>

<span class="c1">// Add Error Middleware</span>
<span class="nv">$errorMiddleware</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addErrorMiddleware</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nv">$errorMiddleware</span><span class="o">-&gt;</span><span class="nf">setDefaultErrorHandler</span><span class="p">(</span><span class="nv">$myErrorHandler</span><span class="p">);</span>

<span class="c1">// ...</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<p>With the second method, you can supply a logger that conforms to the <a href="https://www.php-fig.org/psr/psr-3/">PSR-3 standard</a>, such as one from the popular <a href="https://github.com/Seldaek/monolog/">Monolog</a> library.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Monolog\Logger</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">MyApp\Handlers\MyErrorHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="c1">// Add Routing Middleware</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addRoutingMiddleware</span><span class="p">();</span>

<span class="c1">// Monolog Example</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Logger</span><span class="p">(</span><span class="s1">'app'</span><span class="p">);</span>
<span class="nv">$streamHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StreamHandler</span><span class="p">(</span><span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/var/log'</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="nv">$logger</span><span class="o">-&gt;</span><span class="nf">pushHandler</span><span class="p">(</span><span class="nv">$streamHandler</span><span class="p">);</span>

<span class="c1">// Add Error Middleware with Logger</span>
<span class="nv">$errorMiddleware</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addErrorMiddleware</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">$logger</span><span class="p">);</span>

<span class="c1">// ...</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="error-handlingrendering">Error Handling/Rendering</h2>

<p>The rendering is finally decoupled from the handling.
It will still detect the content-type and render things appropriately with the help of <code class="language-plaintext highlighter-rouge">ErrorRenderers</code>.
The core <code class="language-plaintext highlighter-rouge">ErrorHandler</code> extends the <code class="language-plaintext highlighter-rouge">AbstractErrorHandler</code> class which has been completely refactored.
By default it will call the appropriate <code class="language-plaintext highlighter-rouge">ErrorRenderer</code> for the supported content types. 
The core <code class="language-plaintext highlighter-rouge">ErrorHandler</code> defines renderers for the following content types:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">application/json</code></li>
  <li><code class="language-plaintext highlighter-rouge">application/xml</code> and <code class="language-plaintext highlighter-rouge">text/xml</code></li>
  <li><code class="language-plaintext highlighter-rouge">text/html</code></li>
  <li><code class="language-plaintext highlighter-rouge">text/plain</code></li>
</ul>

<p>For any content type you can register your own error renderer. 
So first define a new error renderer that implements <code class="language-plaintext highlighter-rouge">\Slim\Interfaces\ErrorRendererInterface</code>.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Slim\Interfaces\ErrorRendererInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Throwable</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MyCustomErrorRenderer</span> <span class="kd">implements</span> <span class="nc">ErrorRendererInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__invoke</span><span class="p">(</span><span class="kt">Throwable</span> <span class="nv">$exception</span><span class="p">,</span> <span class="kt">bool</span> <span class="nv">$displayErrorDetails</span><span class="p">):</span> <span class="kt">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'My awesome format'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And then register that error renderer in the core error handler. 
In the example below we will register the renderer to be used for <code class="language-plaintext highlighter-rouge">text/html</code> content types.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">MyApp\Handlers\MyErrorHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="c1">// Add Routing Middleware</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addRoutingMiddleware</span><span class="p">();</span>

<span class="c1">// Add Error Middleware</span>
<span class="nv">$errorMiddleware</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">addErrorMiddleware</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// Get the default error handler and register my custom error renderer.</span>
<span class="nv">$errorHandler</span> <span class="o">=</span> <span class="nv">$errorMiddleware</span><span class="o">-&gt;</span><span class="nf">getDefaultErrorHandler</span><span class="p">();</span>
<span class="nv">$errorHandler</span><span class="o">-&gt;</span><span class="nf">registerErrorRenderer</span><span class="p">(</span><span class="s1">'text/html'</span><span class="p">,</span> <span class="nc">MyCustomErrorRenderer</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>

<span class="c1">// ...</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="force-a-specific-content-type-for-error-rendering">Force a specific content type for error rendering</h3>

<p>By default, the error handler tries to detect the error renderer using the <code class="language-plaintext highlighter-rouge">Accept</code> header of the request. 
If you need to force the error handler to use a specific error renderer you can 
write the following.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$errorHandler</span><span class="o">-&gt;</span><span class="nf">forceContentType</span><span class="p">(</span><span class="s1">'application/json'</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="new-http-exceptions">New HTTP Exceptions</h2>

<p>We have added named HTTP exceptions within the application. 
These exceptions work nicely with the native renderers. 
They can each have a <code class="language-plaintext highlighter-rouge">description</code> and <code class="language-plaintext highlighter-rouge">title</code> attribute as well to provide a bit more insight when the native HTML renderer is invoked.</p>

<p>The base class <code class="language-plaintext highlighter-rouge">HttpSpecializedException</code> extends <code class="language-plaintext highlighter-rouge">Exception</code> and comes with the following sub classes:</p>

<ul>
  <li>HttpBadRequestException</li>
  <li>HttpForbiddenException</li>
  <li>HttpInternalServerErrorException</li>
  <li>HttpMethodNotAllowedException</li>
  <li>HttpNotFoundException</li>
  <li>HttpNotImplementedException</li>
  <li>HttpUnauthorizedException</li>
</ul>

<p>You can extend the <code class="language-plaintext highlighter-rouge">HttpSpecializedException</code> class if they need any other response codes that we decide not to provide with the base repository. 
Example if you wanted a 504 gateway timeout exception that behaves like the native ones you would do the following:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">HttpGatewayTimeoutException</span> <span class="kd">extends</span> <span class="nc">HttpSpecializedException</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$code</span> <span class="o">=</span> <span class="mi">504</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'Gateway Timeout.'</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$title</span> <span class="o">=</span> <span class="s1">'504 Gateway Timeout'</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">'Timed out before receiving response from the upstream server.'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To throw HTTP exceptions, use the following code:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Slim\Exception\HttpNotFoundException</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">throw</span> <span class="k">new</span> <span class="nc">HttpNotFoundException</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</code></pre></div></div>

<p>Ensure you pass the <code class="language-plaintext highlighter-rouge">$request</code> object when throwing the exception.</p>



                <nav>
                    <ul class="nav pager">
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                
                                    
                                        <li class="previous">
                                            <a href="routing.html" rel="prev"><i class="fa fa-arrow-left"></i> <small>Packaged Middleware: </small> Routing</a>
                                        </li>
                                    
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                
                                    <li class="next">
                                        <a href="method-overriding.html" rel="next"><small>Packaged Middleware: </small> Method Overriding <i class="fa fa-arrow-right"></i></a>
                                    </li>
                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                    </ul>
                </nav>
            </div>
        </div>
        <footer class="site-footer">
    <p>
        Created and maintained by <br>
        <a href="http://joshlockhart.com">Josh Lockhart</a>,
        <a href="https://www.donielsmith.com" target="_blank">Andrew Smith</a>,
        <a href="http://akrabat.com/" target="_blank">Rob Allen</a>,
        <a href="http://www.lgse.com/" target="_blank">Pierre Bérubé</a>, and the
        <a href="https://github.com/orgs/slimphp/people" target="_blank">Slim Framework Team</a>
    </p>
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" style="margin: 0; padding-top: 20px">
        <input type="hidden" name="cmd" value="_s-xclick">
        <input type="hidden" name="hosted_button_id" value="9YRVXHRZT6H3L">
        <input type="image" src="../../../en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
        <img alt="" border="0" src="../../../en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
</footer>

    </div>
</div>
        <script src="../../../ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="../../../bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <script src="../../../assets/scripts/build/production.min.js"></script>
        
        <script src="../../../npm/docsearch.js%402/dist/cdn/docsearch.min.js"></script>
        <script>
          docsearch({
            apiKey: '8ed5262aecf5240c6d66dbba260f3e51',
            appId: 'KS0N5YSBFY',
            indexName: 'slim-docs',
            inputSelector: '#docsearch',
            debug: true,
            transformData: function (suggestions) {
              for (var i = 0; i < suggestions.length; i++) {
                var suggestion = suggestions[i];

                var docVersion = null;
                var urlFragments = suggestion.url.split("/");
                if (urlFragments.length >= 3 && urlFragments[1] === "docs") {
                  docVersion = urlFragments[2];
                }

                if (suggestion.hierarchy.lvl0 === null) {
                  suggestions[i].hierarchy.lvl0 = docVersion ? "Slim " + docVersion + " - " + suggestion.title : suggestion.title
                }
              }
              return suggestions;
            },
          });
        </script>
        
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </body>
</html>

